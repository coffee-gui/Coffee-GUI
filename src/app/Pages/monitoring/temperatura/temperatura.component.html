<div class="container-fluid">
  <div class="row">
    <div class="col my-4">
      <div class="form-floating">
        <select
          class="form-select"
          id="floatingSelect"
          aria-label="Floating label select example"
          (change)="nodeSelected($event)"
        >
          <option selected value="0">Todos</option>
          <option *ngFor="let node of nodes" value="{{ node.nodeId }}">
            Nodo {{ node.nodeId }}
          </option>
        </select>
        <label for="floatingSelect">Selecciona un nodo</label>
      </div>
    </div>
  </div>
  <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
    <li class="nav-item" role="presentation">
      <button
        class="nav-link active"
        id="pills-home-tab"
        data-bs-toggle="pill"
        data-bs-target="#pills-home"
        type="button"
        role="tab"
        aria-controls="pills-home"
        aria-selected="true"
      >
        InformaciÃ³n Completa
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="pills-profile-tab"
        data-bs-toggle="pill"
        data-bs-target="#pills-profile"
        type="button"
        role="tab"
        aria-controls="pills-profile"
        aria-selected="false"
      >
        Consultar por Fecha
      </button>
    </li>
  </ul>
  <div class="tab-content" id="pills-tabContent">
    <div
      class="tab-pane fade show active"
      id="pills-home"
      role="tabpanel"
      aria-labelledby="pills-home-tab"
      tabindex="0"
    >
      <h2 *ngIf="selectedNode != 0">
        Estado del nodo {{ selectedNode }}: 
        <span class="text text-success" *ngIf="nodeStatus">Encendido </span>
        <span class="text text-danger" *ngIf="!nodeStatus">Apagado </span>
        <a
          routerLink="./settings"
          fragment="change-nodes"
          style="padding-left: 15px"
          >Â¿cambiar estado?</a
        >
      </h2>
      <div class="row" *ngIf="!zeroData">
        <div class="col">
          <h2 *ngIf="selectedNode != 0">
            La direcciÃ³n MAC del nodo {{ selectedNode }} es:
            {{ macAddress | uppercase }}
          </h2>
          <h2>
            El umbral establecido de temperatura es:
            {{ umbral[0].Temperatura }} Â°C
          </h2>
          <h2>El promedio total de temperatura es: {{ media }} Â°C</h2>
          <h2>
            El valor mÃ¡ximo de temperatura registrado fue de: {{ max }} Â°C
          </h2>
          <h2>
            El valor mÃ­nimo de temperatura registrado fue de: {{ min }} Â°C
          </h2>
        </div>
      </div>
      <div class="row" *ngIf="!zeroData">
        <div class="col">
          <table
            class="table table-striped table-bordered border-dark"
            id="generalTable"
          >
            <thead>
              <tr>
                <th scope="col">Fecha</th>
                <th scope="col">Hora</th>
                <th scope="col">Medida</th>
                <th scope="col" *ngIf="selectedNode == 0">Nodo (ID)</th>
              </tr>
            </thead>
            <tbody>
              <tr
                [ngClass]="{
                  'table-danger table-bordered border-dark':
                    data.measure >= umbral[0].Temperatura
                }"
                *ngFor="let data of filterTemperature"
              >
                <td>{{ data.time | date : "dd/MM/yyyy" }}</td>
                <td>{{ data.time | date : "hh:mm a" }}</td>
                <td>{{ data.measure }} Â°C</td>
                <td *ngIf="selectedNode == 0">{{ data.node }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="row text-center" *ngIf="!zeroData">
        <div class="col-sm-12 col-xl-12 my-2">
          <app-button
            color="green"
            text=" Exportar Excel"
            (click)="exportExcel('generalTable', 'Reporte_General_Temperatura')"
            [showExcel]="true"
          ></app-button>
        </div>
        <!-- <div class="col-sm-12 col-xl-6 my-2">
          <app-button
            color="red"
            text=" Exportar PDF"
            (click)="exportPDF('generalTable', 'Reporte_General_Temperatura')"
            [showPDF]="true"
          ></app-button>
        </div> -->
      </div>
      <div class="row" *ngIf="!zeroData">
        <div class="col text-center my-2">
          <h3 *ngIf="selectedNode == 0">GrÃ¡fica de Temperatura</h3>
          <h3 *ngIf="selectedNode != 0">
            GrÃ¡fica de Temperatura para el Nodo {{ selectedNode }}
          </h3>
        </div>
      </div>
      <div class="row" *ngIf="!zeroData">
        <div class="col">
          <div class="row" *ngIf="zeroData || !(filterTemperature.length >= 2)">
            <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
              <div class="card mb-3" style="max-width: 100%">
                <div class="row g-0 align-items-center">
                  <div class="col-md-4">
                    <img
                      src="../../../../assets/voidData.png"
                      class="img-fluid rounded-start p-4"
                      alt="..."
                    />
                  </div>
                  <div class="col-md-8">
                    <div class="card-body">
                      <h5 class="card-title">Lo siento ðŸ˜•</h5>
                      <p class="card-text">
                        No hay registros suficientes aÃºn en la base de datos
                        para mostrar la grÃ¡fica.
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="grafic" *ngIf="filterTemperature.length >= 2">
            <ngx-charts-line-chart
              [legend]="legend"
              [showXAxisLabel]="showXAxisLabel"
              [showYAxisLabel]="showYAxisLabel"
              [xAxis]="xAxis"
              [yAxis]="yAxis"
              [yAxisLabel]="yAxisLabel"
              [timeline]="timeline"
              [results]="multi"
              [autoScale]="autoScale"
              [roundDomains]="roundDomains"
              (select)="onSelect($event)"
            >
            </ngx-charts-line-chart>
          </div>
        </div>
      </div>
      <div class="row" *ngIf="zeroData">
        <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
          <div class="card mb-3" style="max-width: 100%">
            <div class="row g-0 align-items-center">
              <div class="col-md-4">
                <img
                  src="../../../../assets/voidData.png"
                  class="img-fluid rounded-start p-4"
                  alt="..."
                />
              </div>
              <div class="col-md-8">
                <div class="card-body">
                  <h5 class="card-title">Lo siento ðŸ˜•</h5>
                  <p class="card-text">
                    No hay registros actualmente en esta base de datos.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      class="tab-pane fade"
      id="pills-profile"
      role="tabpanel"
      aria-labelledby="pills-profile-tab"
      tabindex="0"
    >
      <h2 *ngIf="selectedNode != 0">
        Estado del nodo {{ selectedNode }}: 
        <span class="text text-success" *ngIf="nodeStatus">Encendido </span>
        <span class="text text-danger" *ngIf="!nodeStatus">Apagado </span>
        <a
          routerLink="./settings"
          fragment="change-nodes"
          style="padding-left: 15px"
          >Â¿cambiar estado?</a
        >
      </h2>
      <div class="row" *ngIf="!zeroData">
        <div class="col">
          <form [formGroup]="filterDate" (submit)="consultDataForDate()">
            <label class="form-label"
              >Ingresa una fecha para la consulta:</label
            >
            <div class="input-group mb-3">
              <input
                type="date"
                class="form-control"
                aria-describedby="button-addon2"
                formControlName="date"
              />
              <button
                class="btn btn-outline-secondary"
                type="submit"
                id="button-addon2"
              >
                Consultar
              </button>
            </div>
          </form>
        </div>
      </div>
      <div class="container-fluid" *ngIf="showMediaOfDate">
        <div class="row">
          <div class="col">
            <h2 *ngIf="selectedNode != 0">
              La direcciÃ³n MAC del nodo {{ selectedNode }} es:
              {{ macAddress | uppercase }}
            </h2>
            <h2>
              El promedio de temperatura el dia {{ date }} fue de:
              {{ mediaOfDate }} Â°C
            </h2>
            <h2>
              El valor mÃ¡ximo de temperatura registrado el dia {{ date }} fue
              de: {{ maxDate }} Â°C
            </h2>
            <h2>
              El valor mÃ­nimo de temperatura registrado el dia {{ date }} fue
              de: {{ minDate }} Â°C
            </h2>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <table
              class="table table-striped table-bordered border-dark"
              id="filterTable"
            >
              <thead>
                <tr>
                  <th scope="col">Fecha</th>
                  <th scope="col">Hora</th>
                  <th scope="col">Medida</th>
                  <th scope="col" *ngIf="selectedNode == 0">Nodo</th>
                </tr>
              </thead>
              <tbody>
                <tr
                  [ngClass]="{
                    'table-danger table-bordered border-dark':
                      data.measure >= umbral[0].Temperatura
                  }"
                  *ngFor="let data of dataFilter"
                >
                  <td>{{ data.time | date : "dd/MM/yyyy" }}</td>
                  <td>{{ data.time | date : "hh:mm a" }}</td>
                  <td>{{ data.measure }} Â°C</td>
                  <td *ngIf="selectedNode == 0">{{ data.node }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="row text-center">
          <div class="col-sm-12 col-xl-12 my-2">
            <app-button
              color="green"
              text=" Exportar Excel"
              (click)="
                exportExcel('filterTable', 'Reporte_' + date + '_Temperatura')
              "
              [showExcel]="true"
            ></app-button>
          </div>
          <!-- <div class="col-sm-12 col-xl-6 my-2">
            <app-button
              color="red"
              text=" Exportar PDF"
              (click)="
                exportPDF('filterTable', 'Reporte_' + date + '_Temperatura')
              "
              [showPDF]="true"
            ></app-button>
          </div> -->
        </div>
        <div class="row">
          <div class="col text-center my-2">
            <h3 *ngIf="selectedNode == 0">
              GrÃ¡fica de Temperatura del DÃ­a {{ date }}
            </h3>
            <h3 *ngIf="selectedNode != 0">
              GrÃ¡fica de Temperatura del DÃ­a {{ date }} para el Nodo
              {{ selectedNode }}
            </h3>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <div class="row" *ngIf="zeroData || !(dataFilter.length >= 2)">
              <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
                <div class="card mb-3" style="max-width: 100%">
                  <div class="row g-0 align-items-center">
                    <div class="col-md-4">
                      <img
                        src="../../../../assets/voidData.png"
                        class="img-fluid rounded-start p-4"
                        alt="..."
                      />
                    </div>
                    <div class="col-md-8">
                      <div class="card-body">
                        <h5 class="card-title">Lo siento ðŸ˜•</h5>
                        <p class="card-text">
                          No hay registros suficientes aÃºn en la base de datos
                          para mostrar la grÃ¡fica.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="grafic" *ngIf="dataFilter.length >= 2">
              <ngx-charts-line-chart
                [legend]="legend"
                [showXAxisLabel]="showXAxisLabel"
                [showYAxisLabel]="showYAxisLabel"
                [xAxis]="xAxis"
                [yAxis]="yAxis"
                [yAxisLabel]="yAxisLabel"
                [timeline]="false"
                [results]="multiFilter"
                [autoScale]="autoScale"
                [roundDomains]="roundDomains"
                (select)="onSelect($event)"
              >
              </ngx-charts-line-chart>
            </div>
          </div>
        </div>
      </div>
      <div class="row" *ngIf="zeroData">
        <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
          <div class="card mb-3" style="max-width: 100%">
            <div class="row g-0 align-items-center">
              <div class="col-md-4">
                <img
                  src="../../../../assets/voidData.png"
                  class="img-fluid rounded-start p-4"
                  alt="..."
                />
              </div>
              <div class="col-md-8">
                <div class="card-body">
                  <h5 class="card-title">Lo siento ðŸ˜•</h5>
                  <p class="card-text">
                    No hay registros actualmente en esta base de datos.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
